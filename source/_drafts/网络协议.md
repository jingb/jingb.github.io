---
title: 网络协议
tags:
---

# 代理
**X-Real-IP 通常被 HTTP 代理用来表示与它产生 TCP 连接的设备 IP，这个设备可能是其他代理，也可能是真正的请求端。需要注意的是，X-Real-IP 目前并不属于任何标准**

# mac
* ip有定位功能，mac没有
* ifconfig和ip addr区别 [详细ip addr指令出来每个字段的含义和作用](https://time.geekbang.org/column/article/7772)

# ip
* 网络号和主机号，子网掩码，计算关系
* ![](https://static001.geekbang.org/resource/image/0b/9e/0b32d6e35ff0bbc5d46cfb87f6669d9e.jpg)
   * D类和Vxlan有关系
   * CIDR解决A类主机号太少，B类主机号太多的问题
* ICMP协议关于 查询报文(ping) 差错报文(traceroute) 

# 交换机
* arp是操作系统内核里就有的逻辑
* 早起局域网可以通过hub这种设备，多人组网玩游戏，缺点是A发个包，hub会广播所以机器，规模大了不行。交换机知道局域网内每个ip对应的mac，通过学习知道，这个叫 转发表。因为ip会变，所以转发表有过期时间
* MAC 层是用来解决多路访问的堵车问题的，**[还无法理解这个堵车问题](https://time.geekbang.org/column/article/8094)**


# 网关
* 网关其实是路由器的一个网口，比方路由器有5个网口连着5个不同的局域网
* 包在局域网间传递，目标ip会不会变，就是转发网关，相反的话是NAT网关

# 路由
* 根据目的ip做配置 route, ip route做配置
* 根据参数（源ip、入口设备……）等做配置叫策略路由

# 数据中心
* 数据中心里面的每一个连接都是需要考虑高可用的。这里首先要考虑的是，如果一台机器只有一个网卡，上面连着一个网线，接入到 TOR 交换机上。如果网卡坏了，或者不小心网线掉了，机器就上不去了。所以，需要至少两个网卡、两个网线插到 TOR 交换机上，但是两个网卡要工作得像一张网卡一样，这就是常说的网卡绑定（bond） -> LACP协议，解决 服务器和交换机 多网口多网线工作得像一张网卡一样的问题
* 

# 云计算里的网络
* 桥接方式是把虚拟机网络和物理机网络拉平了，在一个端里面，问题是规模大了不行
* [SNAT和DNAT](https://segmentfault.com/q/1010000002389520)


# tcpdump
* 抓localhost的包 tcpdump port 8003 -i lo0

# http 
Connection 这个请求头仅对当前连接有效，不是全链路的概念
Proxy-Connection 是用来替代 Connection这个头的，因为有些很老的代理服务器处理不了Connection: Keep-alive 这样的头，会透传到后端服务器，但其实服务器是不支持长连接，所以会有问题

# dns cdn httpdns
![dns解析流程](https://static001.geekbang.org/resource/image/56/d1/569ddad1a0c5a5f60341fbe023b47cd1.jpg)
GSLB为毛分层 -> 有限运营商网络，再是地域
httpdns 解决什么问题 -> 各个公司自建 手机端知道手机是哪个运营商、地域 比localDns解析更优
cname 解决什么问题 -> [知乎](https://www.zhihu.com/question/22916306) 
 
## cdn
* 动态cdn 解决 边缘节点无法缓存动态内容的问题
 * 边缘计算的模式 数据的逻辑计算和存储，也相应的放在边缘的节点
 * cdn更加智能的调度 找离业务更近的 计算节点 和 边缘节点
