---
title: 分布式事务
tags:
---

# 案例与需求

库存服务
1. 有品，调用端无限重试，可以做出入库的那个状态，**不可以改单子的明细**
2. 工厂维修单，调库存失败进入中间状态
  * 拿库存的单据号查询库存服务，库存成功的可以业务单据进入下一个状态，**业务不允许取消**。失败的可以做重试或取消
  * 中间状态解决什么问题？？？第一次用A料，调了库存服务失败，情况未知。用B料再做维修。注：**这种设计有毒，就不能让他们改料。**电商买东西的时候，下单了商品明细就不能修改，只能取消重新下单
3. 暂时没想到什么场景是一定需要中间状态的，中间状态对每个调库存的业务调用方是个巨大的负担

失败原因
1. 网络？重试
2. 没库存？前面的状态做预占
3. 脏数据?

用dubbo存在的问题
1. 一次传输的量巨大数据包怎么处理，量大库存服务处理时间长，很容易超时。其实应该用MQ



# 需求反推原理和现有的实现

<!-- more -->
